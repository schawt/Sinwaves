#!/usr/bin/env python

import sys

import cgi
import cgitb
cgitb.enable()

import matplotlib
matplotlib.use('Agg')
import matplotlib.pylab as plt
import numpy as np

import cStringIO

def main():
    form = cgi.FieldStorage()
    if 'frequency' in form:
        plotAGG(int(form['frequency'].value))
    else:
        print 'Content-type: text/html'
        print 
        print '<html><body>Test %s </body></html>' % "None"

# syntax err?
def plotAGG(freq):
    fig = plt.figure()
    ax = fig.add_subplot(111)
    x = np.linspace(-np.pi, np.pi, 201)
    ax.plot(x, np.sin(x*freq))
    ax.set_title('Sine Wave')
    ax.set_xlabel('Angle [rad]')
    ax.set_ylabel('sin(x)')
    #fig.savefig('test.png')
    #trying
    f = cStringIO.StringIO()
    fig.savefig(f, format='png')
    print 'Content-type: image/png'
    print
    f.seek(0)
    print f.read()
    #print Image.open(imagdata) import Image


if len(sys.argv) > 1 and sys.argv[1] == "--test":
    print
    # If we invoke with --test then we add a verbose and                       
    # pass the remaining arguments to unittest                                 
    sys.argv = [sys.argv[0]] + ["-v"] + sys.argv[2:]
    unittest.main()
else:
    main ()


